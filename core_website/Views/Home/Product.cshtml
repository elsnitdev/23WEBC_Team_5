@{
    ViewData["ActivePage"] = "Product";
}
@model List<SanPham>

<div class="product-model">
    <div class="container">
        @await Html.PartialAsync("_Breadcrumb")
        <h2>Our Products</h2>

        <div class="col-md-9 product-model-sec">
            @foreach (var item in Model)
            {
                // Tính giá sau khi giảm
                var giaSauGiam = item.DonGia * (1 - item.KhuyenMai / 100.0m);
                // Lấy ảnh đầu tiên an toàn
                var firstImage = (item.HinhAnh ?? "").Split(';').FirstOrDefault() ?? "no-image.jpg";
                <div class="product-grid">
                    <a asp-controller="Home" asp-action="Single" asp-route-id="@item.MaSP">
                        <div class="more-product"><span> </span></div>
                        <div class="product-img b-link-stripe b-animate-go thickbox">
                            <img src="~/images/@firstImage"
                            class="img-responsive"
                            alt="@item.TenSP"
                            style="max-width:240px; height:240px; object-fit:cover;" />
                            <div class="b-wrapper">
                                <h4 class="b-animate b-from-left b-delay03">
                                    <button>
                                        <span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span>
                                        Quick View
                                    </button>
                                </h4>
                            </div>
                        </div>
                    </a>
                    <div class="product-info simpleCart_shelfItem">
                        <div class="product-info-cust prt_name">
                            <h4 style="max-width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                @item.TenSP
                            </h4>

                            <!-- Hiển thị giá sau khi giảm -->
                            @if (item.DonGia == giaSauGiam)
                            {
                                <!-- Không có giảm giá -->
                                <span class="item_price text-danger fw-bold">@giaSauGiam.ToString("N0") ₫</span> <!--gia giam-->
                                <p class="disc text-success"></p>
                            }
                            else
                            {
                                <!-- Có khuyến mãi -->
                                <span class="item_price text-danger fw-bold">@giaSauGiam.ToString("N0") ₫</span>
                                <p class="text-muted"><del>@item.DonGia.ToString("N0") ₫</del></p>
                            }


                            <div class="ofr">
                                <p class="pric1 text-muted">
                                    @* <del>@item.DonGia.ToString("N0") ₫</del> *@
                                </p>
                                @if (item.KhuyenMai > 0)
                                {
                                    <p class="disc text-success">-@item.KhuyenMai%</p>
                                }
                                else
                                {
                                    <p class="disc text-success"></p>

                                }
                            </div>

                        <input type="number" class="item_quantity" value="1" min="1" />
                        <input type="button" class="item_add items" value="ADD" />
                        <div class="clearfix"></div>
                    </div>
                </div>
            </div>
            }
        </div>

        @await Html.PartialAsync("_Sidebar")
    </div>
</div>
